<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>

<body>
    <script>
        // async 函数是什么？一句话，它就是 Generator 函数的语法糖。
        // Generator 函数的执行必须靠执行器，而async函数自带执行器。也就是说，async函数的执行，与普通函数一模一样，只要一行。
        // async函数的返回值是 Promise 对象

        // async函数返回的 Promise 对象，必须等到内部所有await命令后面的 Promise 对象执行完，才会发生状态改变，除非遇到return语句或者抛出错误。
        // 也就是说，只有async函数内部的异步操作执行完，才会执行then方法指定的回调函数。

        // 正常情况下，await命令后面是一个 Promise 对象，返回该对象的结果。如果不是 Promise 对象，就直接返回对应的值。


        // 例1
        function timeout1(count) {
            return new Promise((resolve, reject) => {
                console.log('timeout1');
                setTimeout(() => {
                    resolve(++count)
                }, 1000);
            })
        }

        function timeout2(count) {
            return new Promise((resolve, reject) => {
                console.log('timeout2');
                setTimeout(() => {
                    reject(++count)
                }, 1000);
            })
        }

        function timeout3(count) {
            return new Promise((resolve, reject) => {
                console.log('timeout3');
                setTimeout(() => {
                    resolve(++count)
                }, 1000);
            })
        }

        async function asyncFn(count) {
            const count1 = await timeout1(count);
            const count2 = await timeout2(count1);
            const count3 = await timeout3(count2);
        }

        // async函数返回的Promise 对象，是执行then还是catch，取决于最后一个await返回的Promise
        asyncFn(0).then(res => {
            console.log('then', res);
        }).catch(err => {
            console.log('catch', err);
        });


        // 例2
        function sleep(interval) {
            return new Promise(resolve => {
                setTimeout(resolve, interval);
            })
        }

        // 用法
        async function one2FiveInAsync() {
            for (let i = 1; i <= 10; i++) {
                console.log(i);
                await sleep(1000);
            }
        }
        // one2FiveInAsync();
    </script>
</body>

</html>